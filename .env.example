# TechyBot Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# GitHub App Settings
# =============================================================================
# Get these from your GitHub App settings page
GITHUB_APP_ID=123456
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here
GITHUB_PRIVATE_KEY_PATH=./github-private-key.pem

# =============================================================================
# Claude Code CLI Settings
# =============================================================================
# Path to Claude Code CLI (defaults to 'claude' in PATH)
CLAUDE_PATH=claude

# Claude model to use for reviews (optional, uses CLI default if not set)
# Examples: sonnet, opus, haiku, claude-sonnet-4-5-20250929
CLAUDE_MODEL=sonnet

# Optional: Anthropic API key (if set, CLI will use API-key auth)
ANTHROPIC_API_KEY=

# Optional: long-lived OAuth token created by `claude setup-token`
CLAUDE_CODE_OAUTH_TOKEN=

# Optional Claude OAuth (used by internal/oauth if needed)
CLAUDE_ACCESS_TOKEN=
CLAUDE_REFRESH_TOKEN=
CLAUDE_EXPIRES_AT=
CLAUDE_CREDENTIALS_FILE=

# =============================================================================
# Bot Configuration
# =============================================================================
# The username that triggers the bot (e.g., @techy review)
BOT_USERNAME=techy

# Maximum diff size in bytes (diffs larger than this will be truncated)
MAX_DIFF_SIZE=100000

# =============================================================================
# Server Settings
# =============================================================================
PORT=8080

# =============================================================================
# Database Settings
# =============================================================================
# Postgres connection string
# Example: postgres://techy:techy_pass@localhost:5432/techybot?sslmode=disable
DATABASE_URL=postgres://techy:techy_pass@localhost:5432/techybot?sslmode=disable

# =============================================================================
# Redis / Asynq Settings
# =============================================================================
REDIS_ADDR=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0
ASYNQ_QUEUE=reviews
# Concurrency: Number of concurrent workers processing reviews
# Recommended: 10-20 for production with 100+ users
ASYNQ_CONCURRENCY=10
ASYNQ_MAX_RETRY=10

# =============================================================================
# Rate Limiting Settings (for Claude API calls)
# =============================================================================
# Maximum concurrent Claude CLI calls (tokens in bucket)
# Recommended: 10 for production
RATE_LIMIT_MAX_TOKENS=10

# Seconds between token refills
# Lower = more throughput, Higher = more conservative
RATE_LIMIT_REFILL_SEC=10

# =============================================================================
# Retry Settings (Exponential Backoff with Jitter)
# =============================================================================
# Maximum retry attempts for Claude API 429/5xx errors
RETRY_MAX_ATTEMPTS=5

# Initial delay before first retry (milliseconds)
RETRY_INITIAL_DELAY_MS=1000

# Maximum delay between retries (milliseconds)
RETRY_MAX_DELAY_MS=60000

# =============================================================================
# Prompt Cache Settings
# =============================================================================
# Enable prompt caching (reduces API calls for identical prompts)
CACHE_ENABLED=true

# Maximum number of cached responses
CACHE_MAX_SIZE=1000

# Cache TTL in minutes
CACHE_TTL_MIN=30

# =============================================================================
# Request Deduplication Settings
# =============================================================================
# Prevent duplicate requests within TTL window
DEDUP_ENABLED=true

# Deduplication TTL in minutes (same request within this window is ignored)
DEDUP_TTL_MIN=5

# =============================================================================
# Admin API Settings
# =============================================================================
# Required for /api/* endpoints
ADMIN_API_KEY=change-me

# =============================================================================
# Logging
# =============================================================================
# Log level: debug, info, warn, error
LOG_LEVEL=info

# Log format: console (human readable) or json
LOG_FORMAT=console
